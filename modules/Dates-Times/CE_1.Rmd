---
layout: page
title: Exercise - Dates and Times
author: Derek H. Ogle
css: "/css/modules.css"
output:
  html_document:
    self_contained: false
    lib_dir: zlibs
---

```{r echo=FALSE, eval=FALSE}
# Renders an appropriate HTML file for the webpage (CTRL-S and CTRL-ALT-R)
source(file.path(here::here(),"rhelpers/rhelpers.R"))
fnm <- "CE_1"
dnm <- "modules/Dates-Times"
modHTML(file.path(here::here(),dnm,fnm))
FSA::purl2(file.path(here::here(),dnm,paste0(fnm,".Rmd")),
           moreItems=c("opts_chunk","kable","row_spec"))
```
```{r echo=FALSE, results='hide', message=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo=FALSE,results="hide",message=FALSE)
library(tidyverse)
library(lubridate)
```

----

## Stream Discharge
Follow the same descriptions as in the reading for obtaining (just) stream **discharge** data for the Bois Brule and Bad Rivers in northern Wisconsin (see map below) for all of 2020.

```{r echo=FALSE, out.width='60%', fig.show='hold', results='markup'}
knitr::include_graphics("WI_discharge_map.JPG")
```

```{r}
bbr <- read_tsv("https://nwis.waterdata.usgs.gov/usa/nwis/uv/?cb_00060=on&format=rdb&site_no=04025500&period=&begin_date=2020-01-01&end_date=2020-12-31",
                comment="#") %>%
  slice(-1) %>%
  select(-ends_with("cd")) %>%
  rename(discharge=ends_with("00060")) %>%
  mutate(datetime=ymd_hm(datetime),
         discharge=as.numeric(discharge))

bad <- read_tsv("https://nwis.waterdata.usgs.gov/usa/nwis/uv/?cb_00060=on&format=rdb&site_no=04027000&period=&begin_date=2020-01-01&end_date=2020-12-31",
                comment="#") %>%
  slice(-1) %>%
  select(-ends_with("cd")) %>%
  rename(discharge=ends_with("00060")) %>%
  mutate(datetime=ymd_hm(datetime),
         discharge=as.numeric(discharge))

dschrg <- bind_rows(bad,bbr) %>%
  mutate(river=ifelse(site_no=="04027000","Bad","Bois Brule"),
         mon=month(datetime,label=TRUE)) %>%
  select(-site_no) %>%
  relocate(river)
```

Combine these data into one data frame and compute mean discharge by month for each river. Rearrange the resultant data frame so that the monthly results for both rivers are in side-by-side columns. Show your full code and results and comment on any observations that you can make from your summaries.

```{r}
dschrg %>%
  group_by(river,mon) %>%
  summarize(mean=mean(discharge)) %>%
  ungroup() %>%
  pivot_wider(names_from=river,values_from=mean)
```

```{r fig.show="hide"}
ggplot(data=dschrg,mapping=aes(x=datetime,y=discharge,color=river)) +
  geom_line() +
  scale_y_continuous(name="Discharge (cf/s)",trans="log10",
                     expand=expansion(mult=c(0,0.05))) +
  scale_x_datetime(breaks="months",date_labels="%e-%b") +
  theme_bw() +
  theme(axis.title.x=element_blank()) +
  labs(title="Bad and  Bois Brule Rivers, Northern WI",
       subtitle="2020 Stream Discharge",
       caption="source: USGS")
```

## Political Ads in 2016 Presidential Race

